domain: facebook_marketing.fivetran-interop
transforms:
  - name: ad_set_history
    from:
      - ad_sets: facebook_marketing.ad_sets
    fields:
      id:
        expression: ad_sets.id
        description: The ID of the ad set.
      account_id:
        expression: ad_sets.account_id
        description: The ID of the ad account that this ad set belongs to.
      campaign_id:
        expression: ad_sets.campaign_id
        description: Ad campaign that contains this ad set.
      name:
        expression: ad_sets.name
        description: The name of the ad set.
      _fivetran_synced:
        expression: _airbyte_extracted_at
        description: "{{ doc('_fivetran_synced') }}"
      updated_time:
        expression: ad_sets.updated_time
        description: "{{ doc('updated_time') }}"
      start_time:
        expression: ad_sets.start_time
        description: Timestamp of designated ad set start time.
      end_time:
        expression: ad_sets.end_time
        description: Timestamp of designated ad set end time.
      bid_strategy:
        expression: ad_sets.bid_strategy
        description:
          Bid strategy values are - 'LOWEST_COST_WITHOUT_CAP', 'LOWEST_COST_WITH_BID_CAP',
          'COST_CAP', 'LOWEST_COST_WITH_MIN_ROAS'.
      daily_budget:
        expression: ad_sets.daily_budget
        description: Daily budget of ad set.
      budget_remaining:
        expression: ad_sets.budget_remaining
        description: Remaining budget of ad set.
      status:
        expression: MISSING
        description: Status values are - 'ACTIVE', 'PAUSED', 'DELETED', 'ARCHIVED'.
      optimization_goal:
        expression: MISSING
        description:
          The optimization goal this ad set is using. Possible values defined
          [here](https://developers.facebook.com/docs/marketing-api/reference/ad-campaign/#fields).
annotations:
  approved: false
  missing_fields:
    - optimization_goal
    - status
  evaluation:
    source_stream_name: ad_sets
    target_table_name: ad_set_history
    name_match_score: 0.6
    score: 0.55
    explanation:
      The mappings have an overall satisfactory confidence level. However,
      there are issues with the fields 'status' and 'optimization_goal', as their
      expressions are marked 'MISSING', indicating a confidence score of 0.0 for these
      fields. The other mappings have acceptable expression matches, particularly
      '_fivetran_synced' mapped to '_airbyte_extracted_at', which is strongly advised.
      The overall confidence score is reduced due to the missing fields.
    field_mapping_evals:
      - name: id
        expression: ad_sets.id
        score: 1.0
        explanation: The expression 'ad_sets.id' perfectly matches the description.
      - name: account_id
        expression: ad_sets.account_id
        score: 1.0
        explanation: The expression 'ad_sets.account_id' perfectly matches the description.
      - name: campaign_id
        expression: ad_sets.campaign_id
        score: 1.0
        explanation: The expression 'ad_sets.campaign_id' perfectly matches the description.
      - name: name
        expression: ad_sets.name
        score: 1.0
        explanation: The expression 'ad_sets.name' perfectly matches the description.
      - name: _fivetran_synced
        expression: _airbyte_extracted_at
        score: 1.0
        explanation:
          _fivetran_synced is mapped to the correct '_airbyte_extracted_at'
          column.
      - name: updated_time
        expression: ad_sets.updated_time
        score: 0.8
        explanation: The expression 'ad_sets.updated_time' mostly matches the description.
      - name: start_time
        expression: ad_sets.start_time
        score: 1.0
        explanation: The expression 'ad_sets.start_time' perfectly matches the description.
      - name: end_time
        expression: ad_sets.end_time
        score: 1.0
        explanation: The expression 'ad_sets.end_time' perfectly matches the description.
      - name: bid_strategy
        expression: ad_sets.bid_strategy
        score: 1.0
        explanation:
          The expression 'ad_sets.bid_strategy' correctly lists the bid
          strategy values.
      - name: daily_budget
        expression: ad_sets.daily_budget
        score: 1.0
        explanation: The expression 'ad_sets.daily_budget' perfectly matches the description.
      - name: budget_remaining
        expression: ad_sets.budget_remaining
        score: 1.0
        explanation:
          The expression 'ad_sets.budget_remaining' perfectly matches the
          description.
      - name: status
        expression: MISSING
        score: 0.0
        explanation: The expression is 'MISSING', cannot determine the correct mapping.
      - name: optimization_goal
        expression: MISSING
        score: 0.0
        explanation: The expression is 'MISSING', unable to evaluate confidence.

domain: shopify.fivetran-interop
transforms:
  - name: order_discount_code
    from:
      - discount_codes: shopify.discount_codes
    fields:
      _fivetran_synced:
        expression: discount_codes._airbyte_extracted_at
        description: "{{ doc('_fivetran_synced') }}"
      amount:
        expression: discount_codes.total_sales.amount
        description: The amount that's deducted from the order total.
      code:
        expression: discount_codes.code
        description:
          This property returns the discount code that was entered at checkout.
          Otherwise this property returns the title of the discount that was applied.
      order_id:
        expression: MISSING
        description: Associated order ID.
      type:
        expression: discount_codes.discount_type
        description: The type of discount - `fixed_amount`, `percentage`, or `shipping`.
      index:
        expression: MISSING
        description:
          Pairs with `order_id` to provide unique identifier for order
          discount code.
annotations:
  approved: false
  missing_fields:
    - index
    - order_id
  evaluation:
    source_stream_name: discount_codes
    target_table_name: order_discount_code
    name_match_score: 0.65
    score: 0.55
    explanation:
      Field mapping evaluation completed. The overall confidence score
      is based on individual mappings and their confidence levels. Perfect confidence
      found for `_fivetran_synced`, partial confidence for `amount`, `code`, and `type`,
      while `order_id` and `index` have MISSING expressions resulting in zero confidence.
      High name match consistency across fields, except those with missing expressions.
    field_mapping_evals:
      - name: _fivetran_synced
        expression: discount_codes._airbyte_extracted_at
        score: 1.0
        explanation: Mapped to _airbyte_extracted_at perfectly as per guidelines.
      - name: amount
        expression: discount_codes.total_sales.amount
        score: 0.7
        explanation: Confident mapping to a specific total sales amount.
      - name: code
        expression: discount_codes.code
        score: 0.7
        explanation: Code expression matches expected checkout discounts.
      - name: order_id
        expression: MISSING
        score: 0.0
        explanation: Expression missing, resulting in zero confidence.
      - name: type
        expression: discount_codes.discount_type
        score: 0.7
        explanation: Discount type expression aligns with known categorical values.
      - name: index
        expression: MISSING
        score: 0.0
        explanation: Expression missing, resulting in zero confidence.

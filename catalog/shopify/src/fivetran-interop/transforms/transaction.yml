domain: shopify.fivetran-interop
transforms:
  - name: transaction
    from:
      - transactions: shopify.transactions
    fields:
      id:
        expression: transactions.id
        description: The ID for the transaction.
      order_id:
        expression: transactions.order_id
        description: The ID for the order that the transaction is associated with.
      refund_id:
        expression: MISSING
        description: The ID associated with a refund in the refund table.
      amount:
        expression: transactions.amount
        description: The amount of money included in the transaction.
      authorization:
        expression: transactions.authorization
        description: The authorization code associated with the transaction.
      created_at:
        expression: transactions.created_at
        description: The date and time when the transaction was created.
      processed_at:
        expression: transactions.processed_at
        description: The date and time when a transaction was processed.
      device_id:
        expression: transactions.device_id
        description: The ID for the device.
      gateway:
        expression: transactions.gateway
        description: The name of the gateway the transaction was issued through.
      source_name:
        expression: transactions.source_name
        description: The origin of the transaction.
      message:
        expression: transactions.message
        description:
          A string generated by the payment provider with additional information
          about why the transaction succeeded or failed.
      currency:
        expression: transactions.currency
        description:
          The three-letter code (ISO 4217 format) for the currency used
          for the payment.
      location_id:
        expression: transactions.location_id
        description: The ID of the physical location where the transaction was processed.
      parent_id:
        expression: transactions.parent_id
        description: The ID of an associated transaction.
      payment_avs_result_code:
        expression: transactions.payment_details.avs_result_code
        description: The response code from the address verification system.
      payment_credit_card_bin:
        expression: transactions.payment_details.credit_card_bin
        description:
          The issuer identification number (IIN), formerly known as bank
          identification number (BIN) of the customer's credit card.
      payment_cvv_result_code:
        expression: transactions.payment_details.cvv_result_code
        description:
          The response code from the credit card company indicating whether
          the customer entered the card security code, or card verification value,
          correctly.
      payment_credit_card_number:
        expression: transactions.payment_details.credit_card_number
        description:
          The customer's credit card number, with most of the leading digits
          redacted.
      payment_credit_card_company:
        expression: transactions.payment_details.credit_card_company
        description: The name of the company that issued the customer's credit card.
      kind:
        expression: transactions.kind
        description: The transaction's type.
      receipt:
        expression: transactions.receipt
        description: A transaction receipt attached to the transaction by the gateway.
      currency_exchange_id:
        expression: MISSING
        description: The ID of the adjustment.
      currency_exchange_adjustment:
        expression: MISSING
        description:
          The difference between the amounts on the associated transaction
          and the parent transaction.
      currency_exchange_original_amount:
        expression: MISSING
        description: The amount of the parent transaction in the shop currency.
      currency_exchange_final_amount:
        expression: MISSING
        description: The amount of the associated transaction in the shop currency.
      currency_exchange_currency:
        expression: MISSING
        description: The shop currency.
      error_code:
        expression: transactions.error_code
        description: A standardized error code, independent of the payment provider.
      status:
        expression: transactions.status
        description: The status of the transaction.
      test:
        expression: transactions.test
        description: Whether the transaction is a test transaction.
      user_id:
        expression: transactions.user_id
        description:
          The ID for the user who was logged into the Shopify POS device
          when the order was processed, if applicable.
      _fivetran_synced:
        expression: transactions._airbyte_extracted_at
        description: "{{ doc('_fivetran_synced') }}"
      authorization_expires_at:
        expression: MISSING
        description:
          The date and time (ISO 8601 format) when the Shopify Payments
          authorization expires.
annotations:
  approved: false
  missing_fields:
    - authorization_expires_at
    - currency_exchange_adjustment
    - currency_exchange_currency
    - currency_exchange_final_amount
    - currency_exchange_id
    - currency_exchange_original_amount
    - refund_id
  evaluation:
    source_stream_name: transactions
    target_table_name: transaction
    name_match_score: 0.7
    score: 0.65
    explanation:
      The majority of fields have direct mappings with high confidence.
      Fields with 'MISSING' expressions cause a reduction in overall confidence and
      require a score of 0.0. The overall score reflects both the high-confidence
      bindings and penalties from missing expressions.
    field_mapping_evals:
      - name: id
        expression: transactions.id
        score: 0.9
        explanation: Direct match with transactions.id.
      - name: order_id
        expression: transactions.order_id
        score: 0.9
        explanation: Direct match with transactions.order_id.
      - name: refund_id
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: amount
        expression: transactions.amount
        score: 0.9
        explanation: Direct match with transactions.amount.
      - name: authorization
        expression: transactions.authorization
        score: 0.9
        explanation: Direct match with transactions.authorization.
      - name: created_at
        expression: transactions.created_at
        score: 0.9
        explanation: Direct match with transactions.created_at.
      - name: processed_at
        expression: transactions.processed_at
        score: 0.9
        explanation: Direct match with transactions.processed_at.
      - name: device_id
        expression: transactions.device_id
        score: 0.9
        explanation: Direct match with transactions.device_id.
      - name: gateway
        expression: transactions.gateway
        score: 0.9
        explanation: Direct match with transactions.gateway.
      - name: source_name
        expression: transactions.source_name
        score: 0.9
        explanation: Direct match with transactions.source_name.
      - name: message
        expression: transactions.message
        score: 0.9
        explanation: Direct match with transactions.message.
      - name: currency
        expression: transactions.currency
        score: 0.9
        explanation: Direct match with transactions.currency.
      - name: location_id
        expression: transactions.location_id
        score: 0.9
        explanation: Direct match with transactions.location_id.
      - name: parent_id
        expression: transactions.parent_id
        score: 0.9
        explanation: Direct match with transactions.parent_id.
      - name: payment_avs_result_code
        expression: transactions.payment_details.avs_result_code
        score: 0.9
        explanation: Direct match with transactions.payment_details.avs_result_code.
      - name: payment_credit_card_bin
        expression: transactions.payment_details.credit_card_bin
        score: 0.9
        explanation: Direct match with transactions.payment_details.credit_card_bin.
      - name: payment_cvv_result_code
        expression: transactions.payment_details.cvv_result_code
        score: 0.9
        explanation: Direct match with transactions.payment_details.cvv_result_code.
      - name: payment_credit_card_number
        expression: transactions.payment_details.credit_card_number
        score: 0.9
        explanation: Direct match with transactions.payment_details.credit_card_number.
      - name: payment_credit_card_company
        expression: transactions.payment_details.credit_card_company
        score: 0.9
        explanation: Direct match with transactions.payment_details.credit_card_company.
      - name: kind
        expression: transactions.kind
        score: 0.9
        explanation: Direct match with transactions.kind.
      - name: receipt
        expression: transactions.receipt
        score: 0.9
        explanation: Direct match with transactions.receipt.
      - name: currency_exchange_id
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: currency_exchange_adjustment
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: currency_exchange_original_amount
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: currency_exchange_final_amount
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: currency_exchange_currency
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
      - name: error_code
        expression: transactions.error_code
        score: 0.9
        explanation: Direct match with transactions.error_code.
      - name: status
        expression: transactions.status
        score: 0.9
        explanation: Direct match with transactions.status.
      - name: test
        expression: transactions.test
        score: 0.9
        explanation: Direct match with transactions.test.
      - name: user_id
        expression: transactions.user_id
        score: 0.9
        explanation: Direct match with transactions.user_id.
      - name: _fivetran_synced
        expression: transactions._airbyte_extracted_at
        score: 1.0
        explanation: Correct match with transactions._airbyte_extracted_at.
      - name: authorization_expires_at
        expression: MISSING
        score: 0.0
        explanation: Expression is MISSING.
